check_LTLIBRARIES = \
	libgtest.la \
	libgtest_main.la

libgtest_la_SOURCES = \
	ext/gtest/include/gtest/gtest.h \
	ext/gtest/src/gtest-all.cc

libgtest_la_CPPFLAGS = $(GTEST_CPPFLAGS)
libgtest_la_CXXFLAGS = $(GTEST_CXXFLAGS)
libgtest_la_LDFLAGS = $(GTEST_LDFLAGS)
libgtest_la_LIBADD = $(GTEST_LIBS)

libgtest_main_la_SOURCES = \
	ext/gtest/include/gtest/gtest.h \
	ext/gtest/src/gtest_main.cc

libgtest_main_la_CPPFLAGS = $(GTEST_CPPFLAGS)
libgtest_main_la_CXXFLAGS = $(GTEST_CXXFLAGS)
libgtest_main_la_LDFLAGS = $(GTEST_LDFLAGS)
libgtest_main_la_LIBADD = $(GTEST_LIBS) libgtest.la

TEST_ENVIRONMENT =
TESTS =
UNIT_TESTS =
check_PROGRAMS = \
	test/worditer_test \
	test/bed_test

test_worditer_test_SOURCES = test/worditer_test.cc
test_worditer_test_CPPFLAGS = -I$(top_srcdir)/src $(GTEST_CPPFLAGS)
test_worditer_test_CXXFLAGS = $(GTEST_CXXFLAGS)
test_worditer_test_LDFLAGS = $(GTEST_LDFLAGS)
test_worditer_test_LDADD = $(top_srcdir)/libbios++.la \
			  $(GTEST_LIBS) \
			  $(top_srcdir)/libgtest_main.la

test_bed_test_SOURCES = test/bed_test.cc
test_bed_test_CPPFLAGS = -I$(top_srcdir)/src $(GTEST_CPPFLAGS)
test_bed_test_CXXFLAGS = $(GTEST_CXXFLAGS)
test_bed_test_LDFLAGS = $(GTEST_LDFLAGS)
test_bed_test_LDADD = $(top_srcdir)/libbios++.la \
			  $(GTEST_LIBS) \
			  $(top_srcdir)/libgtest_main.la

UNIT_TESTS += $(check_PROGRAMS)
TESTS += $(UNIT_TESTS)

TESTS_ENVIRONMENT_WITH_VALGRIND = \
	"libtool --mode=execute valgrind --leak-check=full"

.PHONY: check-with-valgrind
check-with-valgrind:
	$(MAKE) $(AM_MAKEFLAGS) check \
		TESTS_ENVIRONMENT=$(TESTS_ENVIRONMENT_WITH_VALGRIND)

.PHONY: check-unit-tests
check-unit-tests:
	$(MAKE) $(AM_MAKEFLAGS) check TESTS=$(UNIT_TESTS)

.PHONY: check-unit-tests-with-valgrind
check-unit-tests-with-valgrind:
	$(MAKE) $(AM_MAKEFLAGS) check TESTS=$(UNIT_TESTS) \
		TESTS_ENVIRONMENT=$(TESTS_ENVIRONMENT_WITH_VALGRIND)
